<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
</head>
<style>

h2, .card, .card-title, .form-control {
    padding: 10px;
    text-align: left;
}

.card {
    margin-bottom: 20px;
}

#spacingRow {
    height: 50px;
}

</style>
<body>
    <div class="row" id="spacingRow"></div>
    <div class="container">
        <form>
            <!--name input-->
            <div class="form-group">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon1">Your Name</span>
                    </div>
                    <input type="text" class="form-control" id="friendName" placeholder="2pac Shakur" aria-label="Username" aria-describedby="basic-addon1">
                </div>
            </div>
            <!--url input-->
            <div class="form-group">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" placeholder="https://www.example.com/yourselfie.jpg" id="basic-addon3">https://www.example.com/yourselfie.jpg</span>
                    </div>
                    <input type="text" class="form-control" id="basic-url" aria-describedby="basic-addon3">
                </div>
            </div>
            <!--selection rules-->
            <h4>1 = Strongly Disgree</h4><br>
            <h4>5 = Strongly Agree</h4><br>
            <!--questions output-->
            <div class="row">
                <div id="questionsOutput"></div>
            </div>
            <div class="row" id="spacingRow"></div>
            <!-- Button trigger modal -->
            <button type="submit" class="btn btn-primary" id="submit" data-toggle="modal" data-target="#exampleModal">Submit</button>
            <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Meet Your New BFF</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <h5 id="bffName"></h5>
                            <img id="bffPic" src="" alt="No Image" width = 250px>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>  
        </form>
    </div>
        
    <div class="row" id="spacingRow"></div>
    <footer class="footer">
        <div class="container">
            <p>
                <a href="/api/friends">API Table Link</a>
            </p>
        </div>
    </footer>

<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script type="text/javascript">
var questions = [
    "Your mind is always buzzing with unexplored ideas and plans.",
    "Generally speaking, you rely more on your experience than your imagination.", 
    "You find it easy to stay relaxed and focused even when there is some pressure.", 
    "You rarely do something just out of sheer curiosity.", 
    "People can rarely upset you.", 
    "It is often difficult for you to relate to other people’s feelings.", 
    "In a discussion, truth should be more important than people’s sensitivities.", 
    "You rarely get carried away by fantasies and ideas.", 
    "You think that everyone’s views should be respected regardless of whether they are supported by facts or not.", 
    "You feel more energetic after spending time with a group of people."
]
var index = 1
var loserScore = []

// Populate questions: WORKS
function survey () {
    for (var i = 0; i < questions.length; i++) {
        var questionID = 'q' + index
        var questionDiv = $('<div class="card">')
        var surveyQuestion = $('<div class="card-title">')
        var surveyAnswer = $("<select class='form-control' id=" + questionID + ">")
        questionDiv.append($("<h2> Question " + index + "<br>"))
        surveyQuestion.append($('<h2><br>').append(questions[i]))
        surveyAnswer.append($('<option value="1">1</option>'))
        surveyAnswer.append($('<option value="2">2</option>'))
        surveyAnswer.append($('<option value="3">3</option>'))
        surveyAnswer.append($('<option value="4">4</option>'))
        surveyAnswer.append($('<option value="5">5</option>'))
        questionDiv.append(surveyQuestion)
        questionDiv.append(surveyAnswer)
        index ++
        $('#questionsOutput').append(questionDiv)
    }
}
survey()

// Click button to push to api
$('#submit').on('click', function(event) {
    event.preventDefault();
    var newFriend = {
        name: $("#friendName").val().trim(),
        url: $("#basic-url").val().trim(),
        answer: [
            parseInt($('#q1').val()),
            parseInt($('#q2').val()),
            parseInt($('#q3').val()),
            parseInt($('#q4').val()),
            parseInt($('#q5').val()),
            parseInt($('#q6').val()),
            parseInt($('#q7').val()),
            parseInt($('#q8').val()),
            parseInt($('#q9').val()),
            parseInt($('#q10').val())
        ]
    };
    loserScore.push(newFriend)
    console.log(loserScore)
    $.post("/api/friends", newFriend,
        function(data) {
        $("#friendName").val("");
        $("#basic-url").val("");
    });
    $.ajax({ url: "/api/friends", method: "GET" })
        .then(function(friendsData) {

        // Here we then log the friendsData to console, where it will show up as an object.
        console.log(friendsData);
        console.log("------------------------------------");
        $("#bffName").text(friendsData.name);
        $("#bffPic").attr("src", friendsData.url);
    });
})
</script>
    
</body>
</html>